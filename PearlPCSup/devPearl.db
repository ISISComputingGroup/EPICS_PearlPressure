record(bo, "$(P)$(IOC_NAME)DISABLE"){
    field(DESC, "Disable comms")
    field(PINI, "YES")
    field(VAL, "$(DISABLE=0)")
    field(OMSL, "supervisory")
    field(ZNAM, "COMMS ENABLED")
    field(ONAM, "COMMS DISABLED")
}

record(calc, "$(P)$(IOC_NAME)BUFFER1"){
    field(DESC, "Buffer 1 status values A-K")
    field(CALC, "0")
    field(INPL, "$(P)$(IOC_NAME)STATUS")
    field(FLNK, "$(P)$(IOC_NAME)BUFFER2")
}

record(calc, "$(P)$(IOC_NAME)BUFFER2"){
    field(DESC, "Buffer 2 status values A-D")
    field(CALC, "0")
    field(INPL, "$(P)$(IOC_NAME)STATUS")
}

record(ai, "$(P)$(IOC_NAME)STATUS"){
    field(DESC, "Get Pressure Device Status")
    field(DTYP, "stream")
    field(INP, "@PearlPC.proto get_st($(P)$(IOC_NAME)BUFFER1, $(P)$(IOC_NAME)BUFFER2) $(PORT)")
    field(SCAN, "1 second")
    field(FLNK, "$(P)$(IOC_NAME)BUFFER1")
}

record(ao, "$(P)$(IOC_NAME)SI_PRESSURE:SP"){
    field(DESC, "Set initial ID prefix")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_si $(PORT)")
}

# record(ai, "$(P)$(IOC_NAME)SI_PRESSURE"){
#     field(DESC, "Get initial ID prefix")
#     field(DTYP, "Soft Channel")
# }

record(ao, "$(P)$(IOC_NAME)SD_PRESSURE:SP"){
    field(DESC, "Set secondary ID prefix")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_sd $(PORT)")
}

# record(ai, "$(P)$(IOC_NAME)SD_PRESSURE"){
#     field(DESC, "Get secondary ID prefix")
#     field(DTYP, "Soft Channel")
# }

record(stringin, "$(P)$(IOC_NAME)ID_PRESSURE") {
    field(DESC, "Get ID prefix")
    field(DTYP, "stream")
    field(INP, "@PearlPC.proto get_id $(PORT)")
    field(SCAN, "1 second")
}

record(bo, "$(P)$(IOC_NAME)EM_PRESSURE:SP") {
    field(DESC, "EM stop circuit status")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_EM $(PORT)")
}

record(bi, "$(P)$(IOC_NAME)EM_PRESSURE"){
    field(INP, "$(P)$(IOC_NAME)BUFFER1.A CP MS")
    field(DESC,  "EM stop circuit status")
    field(DTYP, "Soft Channel")
}

record(bo, "$(P)$(IOC_NAME)RU_PRESSURE:SP") {
    field(DESC, "Set Mechanically active status")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_ru $(PORT)")
    field(ZNAM, "Start")
    field(ONAM, "Stop")
}

record(bi, "$(P)$(IOC_NAME)RU_PRESSURE"){
    field(DESC, "Get Mechanically active status")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.B CP MS")
    field(DTYP, "Soft Channel")
    field(ZNAM, "Start")
    field(ONAM, "Stop")
}

record(ao, "$(P)$(IOC_NAME)RE_PRESSURE:SP") {
    field(DESC, "Reset stage for each piston")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_re $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)RE_PRESSURE"){
    field(DESC, "Reset stage for each piston")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.C CP MS")
    field(DTYP, "Soft Channel")
}

record(bo, "$(P)$(IOC_NAME)St_PRESSURE:SP") {
    field(DESC, "Stop bit after each move/manually")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_St $(PORT)")
}

record(bi, "$(P)$(IOC_NAME)St_PRESSURE"){
    field(DESC, "Stop bit after each move/manually")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.D CP MS")
    field(DTYP, "Soft Channel")
}

record(bo, "$(P)$(IOC_NAME)BY_PRESSURE:SP") {
    field(DESC, "Set Busy bit if busy or not")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_by $(PORT)")
}

record(bi, "$(P)$(IOC_NAME)BY_PRESSURE"){
    field(DESC, "Get Busy bit if busy or not")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.E CP MS")
    field(DTYP, "Soft Channel")
}

record(bo, "$(P)$(IOC_NAME)GO_PRESSURE:SP") {
    field(DESC, "Set system initiated by host status")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_GO $(PORT)")
}

record(bi, "$(P)$(IOC_NAME)GO_PRESSURE"){
    field(DESC, "Get system initiated by host status")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.F CP MS")
    field(DTYP, "Soft Channel")
}

record(bo, "$(P)$(IOC_NAME)AM_PRESSURE:SP") {
    field(DESC, "Sets auto/manual switch position")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_AM $(PORT)")
}

record(bi, "$(P)$(IOC_NAME)AM_PRESSURE"){
    field(DESC, "Gets auto/manual switch position")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.G CP MS")
    field(DTYP, "Soft Channel")
}

record(bo, "$(P)$(IOC_NAME)SL_PRESSURE:SP"){
    field(DESC, "Set toggle for loop pressure mode")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_sloop $(PORT)")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
}

record(bi, "$(P)$(IOC_NAME)SL_PRESSURE"){
    field(DESC, "Get loop pressure mode")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.H CP MS")
    field(DTYP, "Soft Channel")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
}

record(ao, "$(P)$(IOC_NAME)SF_PRESSURE:SP"){
    field(DESC, "Set Seal Fail Pressure Value")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_sf $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)SF_PRESSURE"){
    field(DESC, "Get Seal Fail Pressure")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.I CP MS")
    field(DTYP, "Soft Channel")
}

record(ao, "$(P)$(IOC_NAME)ER_PRESSURE:SP") {
    field(DESC, "Last Error Code returned")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_ER $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)ER_PRESSURE"){
    field(DESC,  "Last Error Code returned")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.J CP MS")
    field(DTYP, "Soft Channel")
}

record(ao, "$(P)$(IOC_NAME)PRESSURE:SP"){
    field(DESC, "Set Pressure")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_ra $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)PRESSURE"){
    field(DESC, "Get Pressure from buffer1")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.K CP MS")
    field(DTYP, "Soft Channel")
}

record(calc, "$(P)$(IOC_NAME)PRESSURE_COMPARISON"){
    field(DESC, "Compare pressure against previous val")
    field(SCAN, "1 second") # change to .1 seconds for production?
    field(CALC, "A - B; B := A")
    field(INPA, "$(P)$(IOC_NAME)PRESSURE")
    field(FLNK, "$(P)$(IOC_NAME)PRESSURE_FANOUT")
}

record(fanout, "$(P)$(IOC_NAME)PRESSURE_FANOUT") {
    field(DESC, "Fanout to decrease and increase calcs")
    field(LNK1, "$(P)$(IOC_NAME)DECREASING_PRESSURE_CHECK")
    field(LNK2, "$(P)$(IOC_NAME)INCREASING_PRESSURE_CHECK")
}

record(calcout, "$(P)$(IOC_NAME)DECREASING_PRESSURE_CHECK") {
    field(DESC, "Check if pressure is decreasing")
    field(CALC, "A < 0 ? 1 : 0")
    field(INPA, "$(P)$(IOC_NAME)PRESSURE_COMPARISON")
    field(FLNK, "$(P)$(IOC_NAME)DECREASING_PRESSURE")
}

record(bi, "$(P)$(IOC_NAME)DECREASING_PRESSURE") {
    field(DESC, "Pressure decreasing")
    field(ZNAM, "zero_name")
    field(ONAM, "one_name")
    field(INP,  "$(P)$(IOC_NAME)DECREASING_PRESSURE_CHECK")
}

record(calcout, "$(P)$(IOC_NAME)INCREASING_PRESSURE_CHECK") {
    field(DESC, "Check if pressure is increasing")
    field(CALC, "A > 0 ? 1 : 0")
    field(INPA, "$(P)$(IOC_NAME)PRESSURE_COMPARISON")
    field(FLNK, "$(P)$(IOC_NAME)INCREASING_PRESSURE")
}

record(bi, "$(P)$(IOC_NAME)INCREASING_PRESSURE") {
    field(DESC, "Pressure increasing")
    field(ZNAM, "zero_name")    
    field(ONAM, "one_name")  
    field(INP,  "$(P)$(IOC_NAME)INCREASING_PRESSURE_CHECK")
}

record(ao, "$(P)$(IOC_NAME)MN_PRESSURE:SP"){
    field(DESC, "Set Min Pressure Value")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_mn $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)MN_PRESSURE"){
    field(DESC, "Get Min Pressure")
    field(INP, "$(P)$(IOC_NAME)BUFFER2.A CP MS")
    field(DTYP, "Soft Channel")
}

record(ao, "$(P)$(IOC_NAME)SP_PRESSURE:SP"){
    field(DESC, "Set Setpoint Pressure Value")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_sp $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)SP_PRESSURE"){
    field(DESC, "Get Setpoint Pressure")
    field(INP, "$(P)$(IOC_NAME)BUFFER2.B CP MS")
    field(DTYP, "Soft Channel")
}

record(ao, "$(P)$(IOC_NAME)MX_PRESSURE:SP"){
    field(DESC, "Set Max Pressure Value")
    field(DTYP, "stream")
    field(OUT, "@PearlPC.proto set_mx $(PORT)")
}

record(ai, "$(P)$(IOC_NAME)MX_PRESSURE"){
    field(DESC, "Get Max Pressure")
    field(INP, "$(P)$(IOC_NAME)BUFFER2.C CP MS")
    field(DTYP, "Soft Channel")
}

record(bi, "$(P)$(IOC_NAME)RESET_PRESSURE:SP") {
    field(DESC, "Return pistons to open/closed")
    field(DTYP, "Soft Channel")
    field(OUT, "@PearlPC.proto set_reset_pistons $(PORT)")
    field(ZNAM, "CLOSE")
    field(ONAM, "OPEN")
}

record(bo, "$(P)$(IOC_NAME)RESET_PRESSURE") {
    field(DESC, "Return pistons to open/closed")
    field(INP, "$(P)$(IOC_NAME)BUFFER1.D CP MS")
    field(DTYP, "stream")
    field(ZNAM, "CLOSE")
    field(ONAM, "OPEN")
}
